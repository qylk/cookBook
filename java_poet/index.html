<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>JavaPoet - 小黑屋</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.0.4, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../css/style.min.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">
<div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> <!-- end of book-search-input -->

<nav role="navigation">
<ul class="summary">
<li>
<a href=".." target="_blank" class="custom-link">小黑屋</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="">
<a href="..">首页</a>
<li class="header">Android</li>

<li>
<a href="#">编译/脚本</a>
<ul>

<li>
<a href="../annotation/" class="">Annotation注解处理器</a>
</li>

<li>
<a href="../annotation_debug/" class="">注解处理器调试</a>
</li>

<li>
<a href="../android_flavor/" class="">Android渠道写入方式</a>
</li>
</ul>
</li>

<li>
<a href="#">框架</a>
<ul>

<li>
<a href="../glide/" class="">Glide</a>
</li>

<li>
<a href="../lightKV/" class="">lightKV</a>
</li>

<li>
<a href="../mmkv/" class="">MMKV</a>
</li>

<li>
<a href="../eventbus/" class="">EventBus</a>
</li>

<li>
<a href="../okhttp/" class="">OkHttp</a>
</li>

<li>
<a href="../okhttp_dns/" class="">OkHttp-Dns</a>
</li>
</ul>
</li>

<li>
<a href="#">系统分析</a>
<ul>

<li>
<a href="../strictMode/" class="">StrictMode</a>
</li>

<li>
<a href="../touchEventDispatch/" class="">触摸事件分发</a>
</li>
</ul>
</li>

<li>
<a href="#">Webview</a>
<ul>

<li>
<a href="../webview_cache/" class="">缓存机制</a>
</li>

<li>
<a href="../webview_native/" class="">和Native通信</a>
</li>

<li>
<a href="../webview_bug/" class="">漏洞</a>
</li>

<li>
<a href="../webview_optmize/" class="">优化</a>
</li>
</ul>
</li>

<li>
<a href="#">代码片段</a>
<ul>

<li>
<a href="../code/bubble_view/" class="">微信气泡</a>
</li>
</ul>
</li>

<li>
<a href="#">适配</a>
<ul>

<li>
<a href="../dev_compat/" class="">系统适配</a>
</li>
</ul>
</li>

<li>
<a href="#">安全</a>
<ul>

<li>
<a href="../android_safe/" class="">建议</a>
</li>
</ul>
</li>

<li>
<a href="#">工具</a>
<ul>

<li>
<a href="../adb_input/" class="">adb模拟屏幕触摸</a>
</li>

<li>
<a href="../tcpdump/" class="">tcpdump</a>
</li>
</ul>
</li>

<li>
<a href="#">热修复</a>
<ul>

<li>
<a href="../classloader/" class="">ClassLoader</a>
</li>

<li>
<a href="../instantRun/" class="">Instant Run</a>
</li>

<li>
<a href="../robust/" class="">Robust</a>
</li>

<li>
<a href="../hotFix/" class="">热修复方案</a>
</li>
</ul>
</li>

<li>
<a href="#">未分类</a>
<ul>

<li>
<a href="../keepAlive/" class="">应用保活</a>
</li>
</ul>
</li>

<li>
<a href="#">性能优化</a>
<ul>

<li>
<a href="../bitmap/" class="">Bitmap</a>
</li>
</ul>
</li>

<li class="header">网络</li>

<li>
<a href="../sni/" class="">SNI</a>
</li>

<li class="header">工具</li>

<li>
<a href="../ffmpeg/" class="">FFMPEG</a>
</li>

<li>
<a href="../dmg/" class="">DMG</a>
</li>

<li class="header">Java</li>

<li>
<a href="../mmap/" class="">内存映射</a>
</li>

<li>
<a href="./" class="active">JavaPoet</a>
</li>

<li>
<a href="../volatile/" class="">Volatile</a>
</li>

<li>
<a href="../java_collections/" class="">Collections</a>
</li>

<li>
<a href="../class_access/" class="">access$xxx</a>
</li>

<li>
<a href="#">Concurrent</a>
<ul>

<li>
<a href="../volatile/" class="">volatile</a>
</li>
</ul>
</li>

<li>
<a href="../threadPool/" class="">线程池</a>
</li>

<li>
<a href="../java_generic/" class="">泛型通配符</a>
</li>

<li class="header">虚拟机</li>

<li>
<a href="../jvm/" class="">内存模型</a>
</li>

<li class="chapter" data-path="bookmark/">
<a href="../bookmark/">收藏</a>
<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<h2 id="_1">简介：</h2>
<p>JavaPoet是square推出的开源java代码生成框架，提供Java Api生成.java源文件。</p>
<p>项目主页及源码：<a href="https://github.com/square/javapoet">https://github.com/square/javapoet</a></p>
<h2 id="_2">示例：</h2>
<pre><code class="groovy">compile 'com.squareup:javapoet:1.9.0'
</code></pre>

<p>这是一段普通的java代码：</p>
<pre><code class="java">// This codes are generated automatically. Do not modify!
package com.example.helloworld;

import java.lang.String;
import java.lang.System;

public final class HelloWorld {
  private static final String key = &quot;hello world&quot;;

  public static void main(String[] args) {
    System.out.println(&quot;Hello, JavaPoet!&quot;);
  }
}
</code></pre>

<p>上方的代码是通过下方代码调用JavaPoet的API生成的：</p>
<pre><code class="java">FieldSpec filedSpec = FieldSpec.builder(String.class, &quot;key&quot;, Modifier.STATIC, Modifier.PRIVATE, Modifier.FINAL)
                .initializer(CodeBlock.of(&quot;\&quot;hello world\&quot;&quot;))
                .build();

MethodSpec main = MethodSpec.methodBuilder(&quot;main&quot;)
                .addModifiers(Modifier.PUBLIC, Modifier.STATIC)
                .returns(void.class)
                .addParameter(String[].class, &quot;args&quot;)
                .addStatement(&quot;$T.out.println($S)&quot;, System.class, &quot;Hello, JavaPoet!&quot;)
                .build();

TypeSpec helloWorld = TypeSpec.classBuilder(&quot;HelloWorld&quot;)
                .addField(filedSpec)
                .addModifiers(Modifier.PUBLIC, Modifier.FINAL)
                .addMethod(main)
                .build();

JavaFile javaFile = JavaFile.builder(&quot;com.example.helloworld&quot;, helloWorld)
                .addFileComment(&quot;This codes are generated automatically. Do not modify!&quot;)
                .build();
javaFile.writeTo(System.out);
</code></pre>

<h2 id="_3">代码说明</h2>
<p><img alt="poet" src="../assets/8.png" /></p>
<p>观察JavaPoet的代码主要的类可以分为以下几种：</p>
<ul>
<li>
<p>Spec 用来描述Java中基本的元素，包括类型，注解，字段，方法和参数等。 </p>
<ul>
<li>AnnotationSpec</li>
<li>FieldSpec</li>
<li>MethodSpec</li>
<li>ParameterSpec</li>
<li>TypeSpec</li>
</ul>
</li>
<li>
<p>Name 用来描述类型的引用，包括Void，原始类型（int，long等）和Java类等。 </p>
<ul>
<li>TypeName</li>
<li>ArrayTypeName</li>
<li>ClassName</li>
<li>ParameterizedTypeName</li>
<li>TypeVariableName</li>
<li>WildcardTypeName</li>
</ul>
</li>
<li>
<p>CodeBlock 用来描述代码块的内容，包括普通的赋值，if判断，循环判断等。</p>
</li>
<li>JavaFile 完整的Java文件，JavaPoet的主要的入口。</li>
<li>CodeWriter 读取JavaFile并转换成可阅读可编译的Java源文件。</li>
</ul>
<table>
<thead>
<tr>
<th>key class</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>JavaFile</td>
<td>A Java file containing a single top level class</td>
</tr>
<tr>
<td>TypeSpec</td>
<td>A generated class, interface, or enum declaration</td>
</tr>
<tr>
<td>MethodSpec</td>
<td>A generated constructor or method declaration</td>
</tr>
<tr>
<td>FieldSpec</td>
<td>A generated field declaration</td>
</tr>
<tr>
<td>ParameterSpec</td>
<td>A generated parameter declaration</td>
</tr>
<tr>
<td>AnnotationSpec</td>
<td>A generated annotation on a declaration</td>
</tr>
</tbody>
</table>
<p>JavaPoet提供内部Builder供外部更多更好地进行一些参数的设置以便有层次的扩展性的构造对应的内容。另外它提供$L(for Literals), $S(for Strings), $T(for Types),  $N(for Names)等标识符，用于占位替换。</p>
<h2 id="_4">使用场景：</h2>
<p>1、根据编译时注解生成代码，如<strong>Butterknife</strong></p>
<p>2、根据协议文件生成对应代码，如<strong>Protobuffer</strong></p>
<h2 id="_5">更多例子：</h2>
<p>1、annotationSpec 添加MyAnnotation的注解，然后设置属性hello=world</p>
<pre><code class="java">private static AnnotationSpec makeAnnotationSpec() {
        AnnotationSpec.Builder builder = AnnotationSpec.builder(ClassName.get(&quot;org.wcong.test.poet&quot;, &quot;MyAnnotation&quot;));
        CodeBlock.Builder codeBlockBuilder = CodeBlock.builder().add(&quot;$S&quot;, &quot;world&quot;);
        builder.addMember(&quot;hello&quot;, codeBlockBuilder.build());
        return builder.build();
}
</code></pre>

<p>2、FieldSpec 创建hello的字段并初始化为“world”</p>
<pre><code class="java">private static FieldSpec makeFieldSpec() {
        FieldSpec.Builder fileSpecBuilder = FieldSpec.builder(String.class, &quot;hello&quot;, Modifier.PRIVATE);
        fileSpecBuilder.initializer(CodeBlock.of(&quot;\&quot;world\&quot;&quot;));
        return fileSpecBuilder.build();
}
</code></pre>

<p>3、set、get、toString方法</p>
<pre><code class="java">private static MethodSpec makeSetMethod() {
        MethodSpec.Builder setMethodSpecBuilder = MethodSpec.methodBuilder(&quot;setHello&quot;);
        setMethodSpecBuilder.addModifiers(Modifier.PUBLIC);
        setMethodSpecBuilder.returns(TypeName.VOID);
        ParameterSpec.Builder parameterBuilder = ParameterSpec.builder(TypeName.get(String.class), &quot;hello&quot;);
        setMethodSpecBuilder.addParameter(parameterBuilder.build());
        setMethodSpecBuilder.addCode(CodeBlock.builder().add(&quot;this.hello = hello;\n&quot;).build());
        return setMethodSpecBuilder.build();
}

private static MethodSpec makeGetMethod() {
        MethodSpec.Builder getMethodSpecBuilder = MethodSpec.methodBuilder(&quot;getHello&quot;);
        getMethodSpecBuilder.addModifiers(Modifier.PUBLIC);
        getMethodSpecBuilder.returns(TypeName.get(String.class));
        getMethodSpecBuilder.addCode(CodeBlock.builder().add(&quot;return hello;\n&quot;).build());
        return getMethodSpecBuilder.build();
}
</code></pre>

<pre><code class="java">private static MethodSpec makeToStringMethod() {
        MethodSpec.Builder toStringBuilder = MethodSpec.methodBuilder(&quot;toString&quot;);
        toStringBuilder.addModifiers(Modifier.PUBLIC);
        toStringBuilder.returns(TypeName.get(String.class));
        CodeBlock.Builder toStringCodeBuilder = CodeBlock.builder();
        toStringCodeBuilder.beginControlFlow(&quot;if( hello != null )&quot;);
        toStringCodeBuilder.add(CodeBlock.of(&quot;return \&quot;hello \&quot;+hello;\n&quot;));
        toStringCodeBuilder.nextControlFlow(&quot;else&quot;);
        toStringCodeBuilder.add(CodeBlock.of(&quot;return \&quot;\&quot;;\n&quot;));
        toStringCodeBuilder.endControlFlow();
        toStringBuilder.addCode(toStringCodeBuilder.build());
        return toStringBuilder.build();
}
</code></pre>

<p>4、生成java类</p>
<pre><code class="java">public static void makeJavaFile() {
        TypeSpec.Builder typeSpecBuilder = TypeSpec.classBuilder(&quot;MyClass&quot;);
        typeSpecBuilder.addAnnotation(makeAnnotationSpec());
        typeSpecBuilder.addField(makeFieldSpec());
        typeSpecBuilder.addMethods(makeMethodSpec());
        JavaFile.Builder javaFileBuilder = JavaFile.builder(&quot;org.wcong.test.poet&quot;, typeSpecBuilder.build());
        System.out.println(javaFileBuilder.build().toString());
}
</code></pre>

<hr />
<p>其他资料：</p>
<p><a href="https://juejin.im/entry/58fefebf8d6d810058a610de">JavaPoet 看这一篇就够了</a></p>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../js/main.js"></script>
<script src="../search/main.js"></script>
<script src="../js/gitbook.min.js"></script>
<script src="../js/theme.min.js"></script>
</body>
</html>