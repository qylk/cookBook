<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>风险点 - 小黑屋</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u98ce\u9669\u70b9";
    var mkdocs_page_input_path = "android_danger.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> 小黑屋</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">首页</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Android</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">编译/脚本</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../annotation/">Annotation注解处理器</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../annotation_debug/">注解处理器调试</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../android_flavor/">Android渠道写入方式</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">框架</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../glide/">Glide</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../lightKV/">lightKV</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../mmkv/">MMKV</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../eventbus/">EventBus</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../okhttp/">OkHttp</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../okhttp_dns/">OkHttp-Dns</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../okhttp_retry/">Okhttp重试机制</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../blockCanary/">BlockCanary</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../leakCanary/">LeakCanary</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">系统分析</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../strictMode/">StrictMode</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../touchEventDispatch/">触摸事件分发</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Webview</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../webview_cache/">缓存机制</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../webview_native/">和Native通信</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../webview_bug/">漏洞</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../webview_optmize/">优化</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">代码片段</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../code/bubble_view/">微信气泡</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../zbar/">zbar</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">适配</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../dev_compat/">系统适配</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">多媒体</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../renderscript/">RenderScript</a>
                </li>
    </ul>
                </li>
                <li class=" current">
                    
    <span class="caption-text">安全</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../android_safe/">建议</a>
                </li>
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">风险点</a>
    <ul class="subnav">
            
    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">工具</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../adb_input/">adb模拟屏幕触摸</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../tcpdump/">tcpdump</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">热修复</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../transform.md">Transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../classloader/">ClassLoader</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../instantRun/">Instant Run</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../robust/">Robust</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../hotFix/">热修复方案</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../asm/">ASM</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">未分类</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../keepAlive/">应用保活</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">性能优化</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../bitmap/">Bitmap</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../anr/">Anr</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">网络</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../sni/">SNI</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">工具</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../ffmpeg/">FFMPEG</a>
                </li>
                <li class="">
                    
    <a class="" href="../dmg/">DMG</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Java</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../mmap/">内存映射</a>
                </li>
                <li class="">
                    
    <a class="" href="../java_poet/">JavaPoet</a>
                </li>
                <li class="">
                    
    <a class="" href="../volatile/">Volatile</a>
                </li>
                <li class="">
                    
    <a class="" href="../aspectJ/">AspectJ</a>
                </li>
                <li class="">
                    
    <a class="" href="../java_collections/">Collections</a>
                </li>
                <li class="">
                    
    <a class="" href="../class_access/">access$xxx</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Concurrent</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../volatile/">volatile</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../threadPool/">线程池</a>
                </li>
                <li class="">
                    
    <a class="" href="../java_generic/">泛型通配符</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">虚拟机</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../jvm/">内存模型</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../bookmark/">收藏</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">小黑屋</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>安全 &raquo;</li>
        
      
        
          <li>Android &raquo;</li>
        
      
    
    <li>风险点</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <table>
<thead>
<tr>
<th>风险名称</th>
<th>风险</th>
<th>解决方案</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.App防止反编译</td>
<td>被反编译的暴露客户端逻辑，加密算法，密钥，等等</td>
<td>加固</td>
</tr>
<tr>
<td>2.java层代码源代码反编译风险</td>
<td>被反编译的暴露客户端逻辑，加密算法，密钥，等等</td>
<td>加固 ，混淆</td>
</tr>
<tr>
<td>3.so文件破解风险</td>
<td>导致核心代码泄漏。</td>
<td>so文件加固</td>
</tr>
<tr>
<td>4.篡改和二次打包风险</td>
<td>修改文件资源等，二次打包的添加病毒，广告，或者窃取支付密码，拦截短信等</td>
<td>资源文件混淆和校验签名的hash值</td>
</tr>
<tr>
<td>5.资源文件泄露风险</td>
<td>获取图片，js文件等文件，通过植入病毒，钓鱼页面获取用户敏感信息</td>
<td>资源混淆，加固等等</td>
</tr>
<tr>
<td>6.应用签名未交验风险</td>
<td>反编译或者二次打包，添加病毒代码，恶意代码，上传盗版App</td>
<td>对App进行签名证书校验</td>
</tr>
<tr>
<td>7.代码为混淆风险</td>
<td>业务逻辑暴露，加密算法，账号信息等等。</td>
<td>混淆（中文混淆）</td>
</tr>
<tr>
<td>8.webview明文存储密码风险</td>
<td>用户使用webview默认存储密码到databases/webview.db root的手机可以产看webview数据库，获取用户敏感信息</td>
<td>关闭wenview存储密码功能</td>
</tr>
<tr>
<td>9.明文数字证书风险</td>
<td>APK使用的数字证书用来校验服务器的合法性，保证数据的保密性和完成性 明文存储的证书被篡改造成数据被获取等</td>
<td>客户端校验服务器域名和数字证书等</td>
</tr>
<tr>
<td>10.调试日志函数调用风险</td>
<td>日志信息里面含有用户敏感信息等</td>
<td>关闭调试日志函数，删除打印的日志信息</td>
</tr>
<tr>
<td>11.AES/DES加密方法不安全使用风险</td>
<td>在使用AES/DES加密使用了ECB或者OFB工作模式，加密数据被选择明文攻击破解等</td>
<td>使用CBC和CFB工作模式等</td>
</tr>
<tr>
<td>12.RSA加密算法不安全风险</td>
<td>密数据被选择明文攻击破解和中间人攻击等导致用户敏感信息泄露</td>
<td>密码不要太短，使用正确的工作模式</td>
</tr>
<tr>
<td>13.密钥硬编码风险</td>
<td>用户使用加密算法的密钥设置成一个固定值导致密钥泄漏</td>
<td>动态生成加密密钥或者将密钥进程分段存储等</td>
</tr>
<tr>
<td>14.动态调试攻击风险</td>
<td>攻击者使用GDB，IDA调试追踪目标程序，获取用户敏感信息等</td>
<td>在so文件里面实现对调试进程的监听</td>
</tr>
<tr>
<td>15.应用数据任意备份风险</td>
<td>AndroidMainfest中allowBackup=true 攻击者可以使用adb命令对APP应用数据进行备份造成用户数据泄露</td>
<td>allowBackup=false</td>
</tr>
<tr>
<td>16.全局可读写内部文件风险。</td>
<td>实现不同软件之间数据共享，设置内部文件全局可读写造成其他应用也可以读取或者修改文件等</td>
<td>（1）.使用MODE_PRIVATE模式创建内部存储文件（2）.加密存储敏感数据3.避免在文件中存储明文和敏感信息</td>
</tr>
<tr>
<td>17.SharedPrefs全局可读写内部文件风险。</td>
<td>被其他应用读取或者修改文件等</td>
<td>使用正确的权限</td>
</tr>
<tr>
<td>18.Internal Storage数据全局可读写风险</td>
<td>当设置MODE_WORLD_READBLE或者设置android:sharedUserId导致敏感信息被其他应用程序读取等</td>
<td>设置正确的模式等</td>
</tr>
<tr>
<td>19.getDir数据全局可读写风险</td>
<td>当设置MODE_WORLD_READBLE或者设置android:sharedUserId导致敏感信息被其他应用程序读取等</td>
<td>设置正确的模式等</td>
</tr>
<tr>
<td>20.java层动态调试风险</td>
<td>AndroidManifest中调试的标记可以使用jdb进行调试，窃取用户敏感信息。</td>
<td>android：debuggable=“false”</td>
</tr>
<tr>
<td>21.内网测试信息残留风险</td>
<td>通过测试的Url，测试账号等对正式服务器进行攻击等</td>
<td>讲测试内网的日志清除，或者测试服务器和生产服务器不要使用同一个</td>
</tr>
<tr>
<td>22.随机数不安全使用风险</td>
<td>在使用SecureRandom类来生成随机数，其实并不是随机，导致使用的随机数和加密算法被破解。</td>
<td>（1）不使用setSeed方法（2）使用/dev/urandom或者/dev/random来初始化伪随机数生成器</td>
</tr>
<tr>
<td>23.Http传输数据风险</td>
<td>未加密的数据被第三方获取，造成数据泄露</td>
<td>使用Hpps</td>
</tr>
<tr>
<td>24.Htpps未校验服务器证书风险，Https未校验主机名风险，Https允许任意主机名风险</td>
<td>客户端没有对服务器进行身份完整性校验，造成中间人攻击</td>
<td>（1）.在X509TrustManager中的checkServerTrusted方法对服务器进行校验（2）.判断证书是否过期（3）.使用HostnameVerifier类检查证书中的主机名与使用证书的主机名是否一致</td>
</tr>
<tr>
<td>25.webview绕过证书校验风险</td>
<td>webview使用https协议加密的url没有校验服务器导致中间人攻击</td>
<td>校验服务器证书时候正确</td>
</tr>
<tr>
<td>26.界面劫持风险</td>
<td>用户输入密码的时候被一个假冒的页面遮挡获取用户信息等</td>
<td>（1）.使用第三方专业防界面劫持SDK（2）.校验当前是否是自己的页面</td>
</tr>
<tr>
<td>27.输入监听风险</td>
<td>用户输入的信息被监听或者按键位置被监听造成用户信息泄露等</td>
<td>自定义键盘</td>
</tr>
<tr>
<td>28.截屏攻击风险</td>
<td>对APP运行中的界面进行截图或者录制来获取用户信息</td>
<td>添加属性getWindow().setFlags(FLAG_SECURE)不让用户截图和录屏</td>
</tr>
<tr>
<td>29.动态注册Receiver风险</td>
<td>当动态注册Receiver默认生命周期是可以导出的可以被任意应用访问</td>
<td>使用带权限检验的registerReceiver API进行动态广播的注册</td>
</tr>
<tr>
<td>30.Content Provider数据泄露风险</td>
<td>权限设置不当导致用户信息</td>
<td>正确的使用权限</td>
</tr>
<tr>
<td>31.Service ，Activity，Broadcast,content provider组件导出风险</td>
<td>Activity被第三方应用访问导致被任意应用恶意调用</td>
<td>自定义权限</td>
</tr>
<tr>
<td>32.PendingIntent错误使用Intent风险</td>
<td>使用PendingIntent的时候，如果使用了一个空Intent，会导致恶意用户劫持修改Intent的内容</td>
<td>禁止使用一个空Intent去构造PendingIntent</td>
</tr>
<tr>
<td>33.Intent组件隐式调用风险</td>
<td>使用隐式Intent没有对接收端进行限制导致敏感信息被劫持</td>
<td>1.对接收端进行限制 2.建议使用显示调用方式发送Intent</td>
</tr>
<tr>
<td>34.Intent Scheme URL攻击风险</td>
<td>webview恶意调用App</td>
<td>对Intent做安全限制</td>
</tr>
<tr>
<td>35.Fragment注入攻击风险</td>
<td>出的PreferenceActivity的子类中，没有加入isValidFragment方法，进行fragment名的合法性校验，攻击者可能会绕过限制，访问未授权的界面</td>
<td>（1）.如果应用的Activity组件不必要导出，或者组件配置了intent filter标签，建议显示设置组件的“android:exported”属性为false（2）.重写isValidFragment方法，验证fragment来源的正确性</td>
</tr>
<tr>
<td>36.webview远程代码执行风险</td>
<td>风险：WebView.addJavascriptInterface方法注册可供JavaScript调用的Java对象，通过反射调用其他java类等</td>
<td>建议不使用addJavascriptInterface接口，对于Android API Level为17或者以上的Android系统，Google规定允许被调用的函数，必须在Java的远程方法上面声明一个@JavascriptInterface注解</td>
</tr>
<tr>
<td>37.zip文件解压目录遍历风险</td>
<td>Java代码在解压ZIP文件时，会使用到ZipEntry类的getName()方法，如果ZIP文件中包含“../”的字符串，该方法返回值里面原样返回，如果没有过滤掉getName()返回值中的“../”字符串，继续解压缩操作，就会在其他目录中创建解压的文件</td>
<td>（1）. 对重要的ZIP压缩包文件进行数字签名校验，校验通过才进行解压。 （2）. 检查Zip压缩包中使用ZipEntry.getName()获取的文件名中是否包含”../”或者”..”，检查”../”的时候不必进行URI Decode（以防通过URI编码”..%2F”来进行绕过），测试发现ZipEntry.getName()对于Zip包中有“..%2F”的文件路径不会进行处理。</td>
</tr>
<tr>
<td>38.Root设备运行风险</td>
<td>已经root的手机通过获取应用的敏感信息等</td>
<td>检测是否是root的手机禁止应用启动</td>
</tr>
<tr>
<td>39.模拟器运行风险</td>
<td>刷单，模拟虚拟位置等</td>
<td>禁止在虚拟器上运行</td>
</tr>
<tr>
<td>40.从sdcard加载Dex和so风险</td>
<td>未对Dex和So文件进行安全，完整性及校验，导致被替换，造成用户敏感信息泄露</td>
<td>（1）.放在APP的私有目录 （2）.对文件进行</td>
</tr>
</tbody>
</table>
<p>其他参考：<a href="https://blog.csdn.net/yzzst/article/details/46471277">https://blog.csdn.net/yzzst/article/details/46471277</a></p>
<p><a href="https://ivonhoe.github.io/2017/02/09/%E7%BE%8E%E5%9B%A2%E5%A6%82%E4%BD%95%E9%98%B2dex2jar/">Android安全之应用防dex2jar原理及实现</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../adb_input/" class="btn btn-neutral float-right" title="adb模拟屏幕触摸">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../android_safe/" class="btn btn-neutral" title="建议"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../android_safe/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../adb_input/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
